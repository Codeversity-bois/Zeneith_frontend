<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Zenith Recruitment Assessment</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;family=Fira+Code:wght@400;500&amp;display=swap"
        rel="stylesheet" />
    <!-- Material Symbols -->
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Tailwind Config -->
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2463eb",
                        "background-light": "#f6f6f8",
                        "background-dark": "#111621",
                        "editor-bg": "#1e1e1e",
                        "editor-sidebar": "#252526",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"],
                        "mono": ["Fira Code", "monospace"],
                    },
                    borderRadius: { "DEFAULT": "0.125rem", "lg": "0.25rem", "xl": "0.5rem", "full": "0.75rem" },
                },
            },
        }
    </script>
    <style>
        /* Custom scrollbar for refined look */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 font-display flex flex-col h-screen overflow-hidden">
    <!-- Top Navigation Bar -->
    <header
        class="h-16 bg-white dark:bg-[#1a202c] border-b border-slate-200 dark:border-slate-800 flex items-center justify-between px-6 shrink-0 z-20 shadow-sm relative">
        <div class="flex items-center gap-4">
            <div class="flex items-center justify-center size-8 bg-primary rounded text-white">
                <span class="material-symbols-outlined text-xl">code</span>
            </div>
            <div>
                <h1 id="assessment-title" class="font-bold text-lg leading-tight tracking-tight">Loading...</h1>
                <p id="assessment-subtitle" class="text-xs text-slate-500 dark:text-slate-400 font-medium">Please
                    wait...</p>
            </div>
        </div>
        <div
            class="flex items-center bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-900/30 px-4 py-2 rounded-lg gap-3">
            <span class="material-symbols-outlined text-red-600 dark:text-red-400 animate-pulse">timer</span>
            <div class="flex flex-col items-end leading-none">
                <span class="text-xs text-red-600 dark:text-red-400 font-semibold uppercase tracking-wider">Time
                    Remaining</span>
                <span id="assessment-timer"
                    class="font-mono text-xl font-bold text-red-600 dark:text-red-400">--:--:--</span>
            </div>
        </div>
        <button
            class="bg-primary hover:bg-blue-700 text-white font-bold py-2 px-6 rounded transition-colors duration-200 flex items-center gap-2 shadow-md shadow-blue-500/20"
            onclick="document.getElementById('finish-modal').classList.remove('hidden')">
            <span>Submit Assessment</span>
            <span class="material-symbols-outlined text-sm">arrow_forward</span>
        </button>
    </header>

    <!-- Main Workspace -->
    <div id="assessment-wrapper" class="flex flex-1 overflow-hidden relative">
        <!-- Left Sidebar: Navigation -->
        <aside
            class="w-72 bg-white dark:bg-[#1a202c] border-r border-slate-200 dark:border-slate-800 flex flex-col shrink-0 z-10">
            <!-- Section Selector -->
            <div class="p-4 border-b border-slate-200 dark:border-slate-800">
                <label
                    class="block text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2">Current
                    Section</label>
                <div class="relative">
                    <select id="section-select"
                        class="w-full appearance-none bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 text-slate-900 dark:text-white py-2.5 px-3 pr-8 rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm font-medium">
                        <!-- Dynamic Options -->
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500">
                        <span class="material-symbols-outlined text-lg">expand_more</span>
                    </div>
                </div>
            </div>
            <!-- Question Grid -->
            <div class="flex-1 overflow-y-auto p-4">
                <div id="question-grid" class="grid grid-cols-5 gap-2">
                    <!-- Dynamic Grid -->
                </div>
            </div>
            <!-- Legend -->
            <div
                class="p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-800 text-xs text-slate-600 dark:text-slate-400 space-y-2">
                <div class="flex items-center gap-2"><span class="size-2 rounded-full bg-emerald-500"></span> Answered
                </div>
                <div class="flex items-center gap-2"><span class="size-2 rounded-full bg-primary"></span> Current</div>
                <div class="flex items-center gap-2"><span
                        class="size-2 rounded-full border border-slate-300 dark:border-slate-600"></span> Pending</div>
            </div>
        </aside>
        <!-- Center: Dynamic Workspace -->
        <main id="main-content" class="flex-1 flex overflow-hidden">
            <div class="flex items-center justify-center w-full h-full text-slate-500">
                <div class="flex flex-col items-center gap-4">
                    <span class="animate-spin material-symbols-outlined text-4xl">progress_activity</span>
                    <p>Loading assessment...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- AI Interview Wrapper (Hidden Automatically) -->
    <div id="ai-wrapper" class="hidden flex-1 overflow-hidden relative w-full h-full bg-slate-900 z-40">
        <!-- AI Interface logic will inject content here -->
    </div>

    <!-- Proctoring Widget (PiP) -->
    <div
        class="fixed top-20 right-6 w-56 bg-slate-900 rounded-lg shadow-2xl border border-slate-700 overflow-hidden z-50 group cursor-move">
        <div class="relative aspect-video bg-slate-800">
            <!-- Simulated Webcam Feed -->
            <img alt="Webcam Feed" class="w-full h-full object-cover opacity-80"
                data-alt="Candidate taking assessment in front of computer"
                src="https://lh3.googleusercontent.com/aida-public/AB6AXuAB5EFveHlNGaRKB0T4pvT1r8ksFigjhKtB2rnRJlxtSYUg6Wdr_yL3hsUILKthUcED-7HSuWr69PZOGlptN2FKXXYYjj_9bOGcux92351-u3QRaFumIkrac_yPgDqyhkR7Stm3d02JyUNT8zvFohaVxqZLnUt5vE8GT3HfZUuAw9SVO9o4Ljast6uWDmk_xcnrRkM2wtNGUfNCkGj_3z1UulDYbqtF3sIh4rfw2df_LGY6Xg-hk9sFu857qqtlD9fAGhM9upei6kc" />
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
            <!-- Status Indicators -->
            <div
                class="absolute top-2 left-2 flex items-center gap-1.5 bg-black/60 backdrop-blur-sm px-2 py-0.5 rounded-full border border-white/10">
                <span class="relative flex h-2 w-2">
                    <span
                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span>
                </span>
                <span class="text-[10px] font-medium text-white tracking-wide">REC</span>
            </div>
            <div class="absolute top-2 right-2 text-white/50 hover:text-white cursor-pointer">
                <span class="material-symbols-outlined text-sm">open_in_full</span>
            </div>
            <div class="absolute bottom-2 left-0 right-0 flex justify-center">
                <div class="flex items-center gap-1.5 text-emerald-400">
                    <span class="material-symbols-outlined text-sm">security</span>
                    <span class="text-[10px] font-medium uppercase tracking-wider">Proctoring Active</span>
                </div>
            </div>
        </div>
        <div class="h-1 bg-emerald-500 w-full"></div>
    </div>

    <!-- Finish Modal -->
    <div id="finish-modal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div
                class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div
                            class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                            <span class="material-symbols-outlined text-red-600">warning</span>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Submit Assessment?
                            </h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500">
                                    Are you sure you want to finish the assessment? You won't be able to change your
                                    answers. This will proceed to the AI Interview phase.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button"
                        class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm"
                        onclick="document.getElementById('finish-modal').classList.add('hidden'); window.engine.submitAssessment()">
                        Yes, Submit
                    </button>
                    <button type="button"
                        class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
                        onclick="document.getElementById('finish-modal').classList.add('hidden')">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Logic Script -->
    <script type="module">
        import { AssessmentEngine } from '/src/js/assessment-engine.js';

        document.addEventListener('DOMContentLoaded', () => {
            // Expose engine to window for button OnClicks
            window.engine = new AssessmentEngine({
                title: 'assessment-title',
                subtitle: 'assessment-subtitle',
                timer: 'assessment-timer',
                sectionSelect: 'section-select',
                questionGrid: 'question-grid',
                mainContent: 'main-content',
                assessmentWrapper: 'assessment-wrapper',
                aiWrapper: 'ai-wrapper'
            });

            const params = new URLSearchParams(window.location.search);
            // We now expect sessionId, not assessmentId
            const sessionId = params.get('sessionId');

            if (!sessionId) {
                // For testing/fallback, if assessment ID is present, try to start a new session immediately or alert
                const assessmentId = params.get('id');
                if (assessmentId) {
                    // In real app, we might redirect back to dashboard to start session properly
                    alert('Starting new session...');
                    import('/src/js/assessment-service.js').then(({ assessmentService }) => {
                        assessmentService.startSession(assessmentId).then(res => {
                            window.location.href = `/assessment-taking.html?sessionId=${res.sessionId}`;
                        });
                    });
                    return;
                }

                alert('No session ID provided. Redirecting to dashboard.');
                window.location.href = '/candidate-assessments.html';
                return;
            }

            window.engine.init(sessionId);
        });
    </script>
</body>

</html>